<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="William Tirone">

<title>STA 602 HW11</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="hw11_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw11_files/libs/quarto-html/quarto.js"></script>
<script src="hw11_files/libs/quarto-html/popper.min.js"></script>
<script src="hw11_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw11_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw11_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw11_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw11_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw11_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw11_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STA 602 HW11</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>William Tirone </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="section" class="level1">
<h1>8.1</h1>
<section id="hand-written" class="level2">
<h2 class="anchored" data-anchor-id="hand-written">hand written</h2>
</section>
</section>
<section id="section-1" class="level1">
<h1>8.2</h1>
<p>The full conditionals are listed on p.&nbsp;128 of Hoff, so I am using those and adapting the set up with our priors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># priors </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>mu<span class="fl">.0</span> <span class="ot">=</span> <span class="dv">75</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>gam.<span class="fl">2.0</span> <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>nu<span class="fl">.0</span> <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sig.<span class="fl">2.0</span> <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># priors to iterate </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>d<span class="fl">.0</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>tau.sq<span class="fl">.0</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">500</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># data </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>n.A <span class="ot">=</span> n.B <span class="ot">=</span> <span class="dv">16</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>y.bar.A <span class="ot">=</span> <span class="fl">75.2</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>s.A <span class="ot">=</span> <span class="fl">7.3</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>y.bar.B <span class="ot">=</span> <span class="fl">77.5</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>s.B <span class="ot">=</span> <span class="fl">8.1</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># iterations </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> d<span class="fl">.0</span>) {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> tau.sq<span class="fl">.0</span>) {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># matrix to store values </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>S, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'mu'</span>,<span class="st">'sig2'</span>,<span class="st">'delta'</span>,<span class="st">'theta1'</span>,<span class="st">'theta2'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initial vals </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    data.init <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">100</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    data.curr <span class="ot">=</span> data.init </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gibb's sampler</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S) {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">=</span> data.curr[<span class="dv">1</span>]</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      sig<span class="fl">.2</span> <span class="ot">=</span> data.curr[<span class="dv">2</span>]</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      delta <span class="ot">=</span> data.curr[<span class="dv">3</span>]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      t1 <span class="ot">=</span> data.curr[<span class="dv">4</span>]</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      t2 <span class="ot">=</span> data.curr[<span class="dv">5</span>]</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># draw mu </span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      gam.<span class="fl">2.</span>n <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>gam.<span class="fl">2.0</span> <span class="sc">+</span> (n.A <span class="sc">+</span> n.B) <span class="sc">/</span> sig<span class="fl">.2</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      mu.n <span class="ot">=</span> gam.<span class="fl">2.</span>n <span class="sc">*</span> (mu<span class="fl">.0</span><span class="sc">/</span>gam.<span class="fl">2.0</span> <span class="sc">+</span> (n.A <span class="sc">*</span> (y.bar.A <span class="sc">-</span> delta))<span class="sc">/</span>sig<span class="fl">.2</span> <span class="sc">+</span> </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                          (n.B <span class="sc">*</span> (y.bar.B <span class="sc">+</span> delta))<span class="sc">/</span>sig<span class="fl">.2</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,mu.n,<span class="fu">sqrt</span>(gam.<span class="fl">2.</span>n))</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      <span class="co"># draw sigma2</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      nu.n <span class="ot">=</span> nu<span class="fl">.0</span> <span class="sc">+</span> n.A <span class="sc">+</span> n.B </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      v <span class="ot">=</span> nu<span class="fl">.0</span> <span class="sc">*</span> sig.<span class="fl">2.0</span> <span class="sc">+</span> </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        ((y.bar.A <span class="sc">-</span> (mu <span class="sc">+</span> delta))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (n.A<span class="dv">-1</span>)<span class="sc">*</span>s.A<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        ((y.bar.B <span class="sc">-</span> (mu <span class="sc">-</span> delta))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (n.B<span class="dv">-1</span>)<span class="sc">*</span>s.B<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      sig<span class="fl">.2</span> <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, nu.n <span class="sc">/</span> <span class="dv">2</span>, v <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sample delta </span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      <span class="co"># with params from above </span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>      tau.n<span class="fl">.2</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>k <span class="sc">+</span> (n.A <span class="sc">+</span> n.B)<span class="sc">/</span>sig<span class="fl">.2</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      mean.del <span class="ot">=</span> tau.n<span class="fl">.2</span> <span class="sc">*</span> (j<span class="sc">/</span>k <span class="sc">+</span> ((n.A <span class="sc">*</span> (y.bar.A <span class="sc">-</span> mu)) <span class="sc">/</span> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                             sig<span class="fl">.2</span>) <span class="sc">-</span> ((n.B <span class="sc">*</span> (y.bar.B <span class="sc">-</span> mu))<span class="sc">/</span>sig<span class="fl">.2</span>))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      delta <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,mean.del,<span class="fu">sqrt</span>(tau.n<span class="fl">.2</span>))</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      <span class="co">#update values </span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>      data.curr[<span class="dv">1</span>] <span class="ot">=</span> mu</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>      data.curr[<span class="dv">2</span>] <span class="ot">=</span> sig<span class="fl">.2</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>      data.curr[<span class="dv">3</span>] <span class="ot">=</span> delta </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>      <span class="co">#update thetas</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>      data.curr[<span class="dv">4</span>] <span class="ot">=</span> mu <span class="sc">+</span> delta </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>      data.curr[<span class="dv">5</span>] <span class="ot">=</span> mu <span class="sc">-</span> delta</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      <span class="co"># saving all values </span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      data[i,] <span class="ot">=</span> data.curr </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i:</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  dgt0 <span class="ot">=</span> <span class="fu">mean</span>(data[,<span class="st">'delta'</span>] <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ii: </span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  interval <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">quantile</span>(data[,<span class="st">'delta'</span>],<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="dv">2</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># iii: </span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  prior_corr <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  post_corr <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">cor</span>(data[,<span class="st">'theta1'</span>],data[,<span class="st">'theta2'</span>]),<span class="dv">2</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"d0:"</span>, j, <span class="st">"tau_sq0: "</span>, k, </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>      <span class="st">"p(d&lt;0|Y):"</span>,dgt0, </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>      <span class="st">"95% interval:"</span>, interval,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>      <span class="st">"corrs:"</span>,prior_corr,post_corr,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>d0: -4 tau_sq0:  10 p(d&lt;0|Y): 0.9005 95% interval: -4.22 0.84 corrs: 1 0.08 
d0: -4 tau_sq0:  50 p(d&lt;0|Y): 0.8245 95% interval: -3.97 1.52 corrs: 1 0.01 
d0: -4 tau_sq0:  100 p(d&lt;0|Y): 0.8136 95% interval: -3.94 1.47 corrs: 1 0.01 
d0: -4 tau_sq0:  500 p(d&lt;0|Y): 0.7985 95% interval: -3.94 1.58 corrs: 1 -0.01 
d0: -2 tau_sq0:  10 p(d&lt;0|Y): 0.8447 95% interval: -3.77 1.18 corrs: 1 0.08 
d0: -2 tau_sq0:  50 p(d&lt;0|Y): 0.8097 95% interval: -3.86 1.46 corrs: 1 0 
d0: -2 tau_sq0:  100 p(d&lt;0|Y): 0.8013 95% interval: -3.9 1.64 corrs: 1 -0.02 
d0: -2 tau_sq0:  500 p(d&lt;0|Y): 0.8001 95% interval: -3.83 1.62 corrs: 1 0 
d0: 0 tau_sq0:  10 p(d&lt;0|Y): 0.7761 95% interval: -3.47 1.6 corrs: 1 0.08 
d0: 0 tau_sq0:  50 p(d&lt;0|Y): 0.8016 95% interval: -3.78 1.55 corrs: 1 0.01 
d0: 0 tau_sq0:  100 p(d&lt;0|Y): 0.7954 95% interval: -3.85 1.64 corrs: 1 -0.01 
d0: 0 tau_sq0:  500 p(d&lt;0|Y): 0.7973 95% interval: -3.88 1.59 corrs: 1 0 
d0: 2 tau_sq0:  10 p(d&lt;0|Y): 0.7017 95% interval: -3.11 1.92 corrs: 1 0.09 
d0: 2 tau_sq0:  50 p(d&lt;0|Y): 0.78 95% interval: -3.7 1.67 corrs: 1 0.02 
d0: 2 tau_sq0:  100 p(d&lt;0|Y): 0.7848 95% interval: -3.84 1.68 corrs: 1 -0.02 
d0: 2 tau_sq0:  500 p(d&lt;0|Y): 0.7975 95% interval: -3.78 1.63 corrs: 1 -0.01 
d0: 4 tau_sq0:  10 p(d&lt;0|Y): 0.6072 95% interval: -2.76 2.25 corrs: 1 0.07 
d0: 4 tau_sq0:  50 p(d&lt;0|Y): 0.7668 95% interval: -3.59 1.75 corrs: 1 0.02 
d0: 4 tau_sq0:  100 p(d&lt;0|Y): 0.7818 95% interval: -3.77 1.68 corrs: 1 0 
d0: 4 tau_sq0:  500 p(d&lt;0|Y): 0.797 95% interval: -3.91 1.63 corrs: 1 -0.01 </code></pre>
</div>
</div>
<section id="b" class="level2">
<h2 class="anchored" data-anchor-id="b">b)</h2>
<p>I would tell people of different opinions that even considering a variety of combinations of <span class="math inline">\(\delta_0\)</span> and <span class="math inline">\(\tau_0^2\)</span>, the posterior probability that <span class="math inline">\(p(\delta&lt;0 | Y)\)</span> is greater than .5 in every case and in most cases is &gt; .75. Though part of the interval includes 0, it seems reasonably unlikely that having a different prior opinion, given the data, would dramatically change the posterior. There is also weak posterior correlation between <span class="math inline">\(\theta_A\)</span> and <span class="math inline">\(\theta_B\)</span>.</p>
</section>
</section>
<section id="section-2" class="level1">
<h1>8.3</h1>
<section id="a" class="level2">
<h2 class="anchored" data-anchor-id="a">a)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">=</span> <span class="st">'http://www2.stat.duke.edu/~pdh10/FCBS/Exercises'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set up a matrix to hold the school data </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>s.data <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(s.data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'score'</span>,<span class="st">'school'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># will use source in calculations later</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(base_url,<span class="st">'/'</span>,<span class="st">'school'</span>,i,<span class="st">'.dat'</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> a <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">school =</span> i)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(a) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'score'</span>,<span class="st">'school'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  s.data <span class="ot">=</span> <span class="fu">rbind</span>(s.data,a)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder cols </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>s.data <span class="ot">=</span> s.data[<span class="sc">-</span><span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Referencing Hoff p.&nbsp;137-138.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> s.data</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># priors </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">=</span> <span class="dv">7</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>g20 <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>t20 <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>eta0 <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>s20 <span class="ot">=</span> <span class="dv">15</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>nu0 <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">## starting values</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>m<span class="ot">&lt;-</span><span class="fu">length</span>(<span class="fu">unique</span>(Y[,<span class="dv">1</span>]))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span>sv<span class="ot">&lt;-</span>ybar<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="cn">NA</span>,m) </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  ybar[j]<span class="ot">&lt;-</span><span class="fu">mean</span>(Y[Y[,<span class="dv">1</span>]<span class="sc">==</span>j,<span class="dv">2</span>])</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  sv[j]<span class="ot">&lt;-</span><span class="fu">var</span>(Y[Y[,<span class="dv">1</span>]<span class="sc">==</span>j,<span class="dv">2</span>])</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  n[j]<span class="ot">&lt;-</span><span class="fu">sum</span>(Y[,<span class="dv">1</span>]<span class="sc">==</span>j)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>theta<span class="ot">&lt;-</span>ybar</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>sigma2<span class="ot">&lt;-</span><span class="fu">mean</span>(sv)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">mean</span>(theta)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>tau2<span class="ot">&lt;-</span><span class="fu">var</span>(theta)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="do">## setup MCMC</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>S<span class="ot">&lt;-</span><span class="dv">5000</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>THETA<span class="ot">&lt;-</span><span class="fu">matrix</span>( <span class="at">nrow=</span>S,<span class="at">ncol=</span>m)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>MST<span class="ot">&lt;-</span><span class="fu">matrix</span>( <span class="at">nrow=</span>S,<span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="do">## MCMC algorithm</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S) </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample new values of the thetas</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    vtheta<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>(n[j]<span class="sc">/</span>sigma2<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span>tau2)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    etheta<span class="ot">&lt;-</span>vtheta<span class="sc">*</span>(ybar[j]<span class="sc">*</span>n[j]<span class="sc">/</span>sigma2<span class="sc">+</span>mu<span class="sc">/</span>tau2)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    theta[j]<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">1</span>,etheta,<span class="fu">sqrt</span>(vtheta))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sample new value of sigma2</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  nun<span class="ot">&lt;-</span>nu0<span class="sc">+</span><span class="fu">sum</span>(n)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  ss<span class="ot">&lt;-</span>nu0<span class="sc">*</span>s20;<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m){ss<span class="ot">&lt;-</span>ss<span class="sc">+</span><span class="fu">sum</span>((Y[Y[,<span class="dv">1</span>]<span class="sc">==</span>j,<span class="dv">2</span>]<span class="sc">-</span>theta[j])<span class="sc">^</span><span class="dv">2</span>)}</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  sigma2<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,nun<span class="sc">/</span><span class="dv">2</span>,ss<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sample a new value of mu</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  vmu<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(m<span class="sc">/</span>tau2<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span>g20)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  emu<span class="ot">&lt;-</span> vmu<span class="sc">*</span>(m<span class="sc">*</span><span class="fu">mean</span>(theta)<span class="sc">/</span>tau2 <span class="sc">+</span> mu0<span class="sc">/</span>g20)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  mu<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">1</span>,emu,<span class="fu">sqrt</span>(vmu)) </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample a new value of tau2</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  etam<span class="ot">&lt;-</span>eta0<span class="sc">+</span>m</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  ss<span class="ot">&lt;-</span> eta0<span class="sc">*</span>t20 <span class="sc">+</span> <span class="fu">sum</span>( (theta<span class="sc">-</span>mu)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  tau2<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,etam<span class="sc">/</span><span class="dv">2</span>,ss<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#store results</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  THETA[s,]<span class="ot">&lt;-</span>theta</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  MST[s,]<span class="ot">&lt;-</span><span class="fu">c</span>(mu,sigma2,tau2)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>mcmc<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">THETA=</span>THETA,<span class="at">MST=</span>MST)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mcmc<span class="sc">$</span>MST) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'sig2'</span>,<span class="st">'mu'</span>,<span class="st">'tau2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assessing convergence:</p>
<p>Effective Sample Size for parameters, meets requirements of &gt; 1000 from problem set up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mcmc<span class="sc">$</span>MST)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    sig2       mu     tau2 
4177.568 4739.021 3618.343 </code></pre>
</div>
</div>
<p>It looks like there’s low autocorrelation so that’s a good sign that the chain can move around the space of the distribution freely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(mcmc<span class="sc">$</span>MST[,<span class="st">'sig2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(mcmc<span class="sc">$</span>MST[,<span class="st">'mu'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(mcmc<span class="sc">$</span>MST[,<span class="st">'tau2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The trace plots look good as well so I think the chain has converged.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>THETA.coda <span class="ot">&lt;-</span> <span class="fu">mcmc</span>(mcmc<span class="sc">$</span>MST[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>),], <span class="at">start =</span> <span class="dv">1001</span>) <span class="co"># no burn-in steps</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(THETA.coda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="b-1" class="level2">
<h2 class="anchored" data-anchor-id="b-1">b)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior confidence intervals for params </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>my_quant <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(x,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Posterior C.I."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior C.I."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mcmc<span class="sc">$</span>MST,<span class="dv">2</span>,<span class="at">FUN=</span>my_quant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          sig2       mu     tau2
2.5%  5.914609 11.73272  1.90546
97.5% 9.127841 17.82171 14.89749</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and posterior means </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Posterior Means: "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior Means: "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mcmc<span class="sc">$</span>MST,<span class="dv">2</span>,<span class="at">FUN=</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     sig2        mu      tau2 
 7.548069 14.484101  5.601912 </code></pre>
</div>
</div>
<p>Plotting the prior densities below; for my answers here I’m also referencing the coda output from part a) of this question. So overall we learned mu is actually centered around 14 rather than 7 as the prior suggested, and it also has wider variance as evidenced by the fatter tails in the plot in part a). We placed fairly weak priors on both <span class="math inline">\(\tau^2\)</span> and <span class="math inline">\(\sigma^2\)</span> so really any new information will modify those. For <span class="math inline">\(\tau^2\)</span> we see less change from the prior, with a posterior center around 5 and a fairly strong right skew. In <span class="math inline">\(\sigma^2\)</span> above we have much more equal tails and a center around 8, so that has changed more dramatically from the prior to posterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">20</span>,<span class="fl">0.1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mu.prior <span class="ot">=</span> <span class="fu">dnorm</span>(x1,<span class="dv">7</span>,<span class="fu">sqrt</span>(<span class="dv">5</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x1,mu.prior,<span class="at">type=</span><span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInvGamma</span>(<span class="dv">1</span>,<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInvGamma</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="c" class="level2">
<h2 class="anchored" data-anchor-id="c">c)</h2>
<p>Comparing the two plots, it looks like there is less evidence for between-school variation (though I’m not positive my plots make sense) because the values center around R = 0.3 while the prior doesn’t necessarily have a center. This might be the result of a weak prior (or not plotting properly, I’m not sure!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prior plot </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, .<span class="dv">01</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">dinvgamma</span>(s, <span class="dv">1</span>, <span class="dv">10</span>) <span class="sc">/</span> (<span class="fu">dinvgamma</span>(s, <span class="dv">1</span>, <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">dinvgamma</span>(s, <span class="dv">1</span>, <span class="dv">15</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="fu">density</span>(mcmc<span class="sc">$</span>MST[,<span class="st">'tau2'</span>] <span class="sc">/</span> (mcmc<span class="sc">$</span>MST[,<span class="st">'tau2'</span>]<span class="sc">+</span> mcmc<span class="sc">$</span>MST[,<span class="st">'sig2'</span>]))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, d, <span class="at">type =</span> <span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(q,<span class="at">type=</span><span class="st">'l'</span>,<span class="at">main=</span><span class="st">'density posterior plot of R'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="d" class="level2">
<h2 class="anchored" data-anchor-id="d">d)</h2>
<p>posterior probability, <span class="math inline">\(p(\theta_7 &lt; \theta_6)\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mcmc<span class="sc">$</span>THETA[,<span class="dv">7</span>] <span class="sc">&lt;</span> mcmc<span class="sc">$</span>THETA[,<span class="dv">6</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5104</code></pre>
</div>
</div>
<p>And posterior probability that <span class="math inline">\(\theta_7\)</span> is the smallest of all schools:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mcmc<span class="sc">$</span>THETA[,<span class="dv">7</span>] <span class="sc">&lt;</span> mcmc<span class="sc">$</span>THETA[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">8</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7922286</code></pre>
</div>
</div>
</section>
<section id="e" class="level2">
<h2 class="anchored" data-anchor-id="e">e)</h2>
<p>The sample means were pretty close to the posterior expectations. I actually plotted the residuals here because they looked very linear, and it seems like there’s fairly little difference since the residuals are centered around 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sample.means <span class="ot">=</span> <span class="fu">c</span>() </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  ybar <span class="ot">=</span> <span class="fu">mean</span>(s.data[s.data[,<span class="dv">1</span>]<span class="sc">==</span>i,<span class="dv">2</span>])</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  sample.means <span class="ot">=</span> <span class="fu">c</span>(sample.means,ybar)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>posterior.means <span class="ot">=</span> <span class="fu">apply</span>(mcmc<span class="sc">$</span>THETA,<span class="dv">2</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posterior.means<span class="sc">-</span>sample.means)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw11_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comparing the total means here, which is pretty interesting because the difference is quite large (if I’ve done this correctly and the gibb’s sampler worked etc.). This indicates that the samples had a very large variance that we “removed” in the MCMC process. I don’t think that’s technically correct but I think this amounts to having pretty unreliable samples. But obviously averaging across the multiple schools will flatten the data and give us less insight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total sample mean:"</span>, <span class="fu">mean</span>(s.data[,<span class="dv">2</span>]),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total sample mean: 7.691278 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total posterior mean:"</span>, <span class="fu">mean</span>(mcmc<span class="sc">$</span>MST[,<span class="st">'mu'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total posterior mean: 14.4841</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>